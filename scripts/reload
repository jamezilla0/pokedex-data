#!/usr/bin/env bash

# Path from where this script is called
__PATH__=`readlink -f ./`

echo "Reloading CSV data from latest veekun/pokedex master..."

# CD to root path
cd ${__PATH__}

# Recreate csv dir
rm -rf csv

# Create sql dir if does not exist
mkdir -p sql

# Recreate tmp dir if does not exist and cd
mkdir -p tmp
cd tmp

# Clone original data source from Veekun and move files
if [ -d "veekun-pokedex/.git" ]; then
    cd veekun-pokedex
    git checkout master
    git reset --hard
    git pull -f
    cd ..
else
    rm -rf veekun-pokedex # in case it exists, but it's not a git repo.
    git clone https://github.com/veekun/pokedex.git veekun-pokedex || exit 1
fi

cd ..
## WIP, this will be generated by the migration script, from the temporary DB:
cp -R tmp/veekun-pokedex/pokedex/data/csv csv || exit 1
# Remove all Conquest-related data (which does not belong to the main series)
rm -f csv/conquest*.csv csv/conquest.csv
cp tmp/veekun-pokedex/README csv/README || exit 1
cp tmp/veekun-pokedex/LICENSE csv/LICENSE || exit 1

echo "DONE!"
exit 0